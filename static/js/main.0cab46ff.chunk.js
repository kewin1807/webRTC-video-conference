(this.webpackJsonpvideo=this.webpackJsonpvideo||[]).push([[0],{1261:function(e,t,a){},1310:function(e,t,a){},1381:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),r=a(13),i=a.n(r),c=a(84),s=a(85),l=a(96),d=a(93),u=a(174),m=a(106),h=a.n(m),f=a(142),g=a(107),p=a.n(g),v=a(143),w=a.n(v),y=a(1400),b=a(1398),S=a(157),E=a.n(S),C=a(158),k=a.n(C),M=a(160),x=a.n(M),O=a(161),j=a.n(O),A=a(162),D=a.n(A),T=a(163),U=a.n(T),V=a(159),P=a.n(V),N=a(164),F=a.n(N),R=a(1402),I=a(1401),W=a(1404),L=a(173),J=(a(1259),a(1405)),q=a(69),B=(a(1260),a(1261),"https://video.sebastienbiollo.com"),H={},z={iceServers:[{urls:"stun:stun.l.google.com:19302"}]},$=null,G=null,Y=0,K=function(e){Object(l.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).getPermissions=Object(f.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({video:!0}).then((function(){return n.videoAvailable=!0})).catch((function(){return n.videoAvailable=!1}));case 3:return e.next=5,navigator.mediaDevices.getUserMedia({audio:!0}).then((function(){return n.audioAvailable=!0})).catch((function(){return n.audioAvailable=!1}));case 5:navigator.mediaDevices.getDisplayMedia?n.setState({screenAvailable:!0}):n.setState({screenAvailable:!1}),(n.videoAvailable||n.audioAvailable)&&navigator.mediaDevices.getUserMedia({video:n.videoAvailable,audio:n.audioAvailable}).then((function(e){window.localStream=e,n.localVideoref.current.srcObject=e})).then((function(e){})).catch((function(e){return console.log(e)})),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.log(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])}))),n.getMedia=function(){n.setState({video:n.videoAvailable,audio:n.audioAvailable},(function(){n.getUserMedia(),n.connectToSocketServer()}))},n.getUserMedia=function(){if(n.state.video&&n.videoAvailable||n.state.audio&&n.audioAvailable)navigator.mediaDevices.getUserMedia({video:n.state.video,audio:n.state.audio}).then(n.getUserMediaSuccess).then((function(e){})).catch((function(e){return console.log(e)}));else try{n.localVideoref.current.srcObject.getTracks().forEach((function(e){return e.stop()}))}catch(e){}},n.getUserMediaSuccess=function(e){try{window.localStream.getTracks().forEach((function(e){return e.stop()}))}catch(o){console.log(o)}window.localStream=e,n.localVideoref.current.srcObject=e;var t=function(e){if(e===G)return"continue";H[e].addStream(window.localStream),H[e].createOffer().then((function(t){H[e].setLocalDescription(t).then((function(){$.emit("signal",e,JSON.stringify({sdp:H[e].localDescription}))})).catch((function(e){return console.log(e)}))}))};for(var a in H)t(a);e.getTracks().forEach((function(e){return e.onended=function(){n.setState({video:!1,audio:!1},(function(){try{n.localVideoref.current.srcObject.getTracks().forEach((function(e){return e.stop()}))}catch(o){console.log(o)}window.localStream=function(){var e;return new MediaStream([(e=n).black.apply(e,arguments),n.silence()])}(),n.localVideoref.current.srcObject=window.localStream;var e=function(e){H[e].addStream(window.localStream),H[e].createOffer().then((function(t){H[e].setLocalDescription(t).then((function(){$.emit("signal",e,JSON.stringify({sdp:H[e].localDescription}))})).catch((function(e){return console.log(e)}))}))};for(var t in H)e(t)}))}}))},n.getDislayMedia=function(){n.state.screen&&navigator.mediaDevices.getDisplayMedia&&navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0}).then(n.getDislayMediaSuccess).then((function(e){})).catch((function(e){return console.log(e)}))},n.getDislayMediaSuccess=function(e){try{window.localStream.getTracks().forEach((function(e){return e.stop()}))}catch(o){console.log(o)}window.localStream=e,n.localVideoref.current.srcObject=e;var t=function(e){if(e===G)return"continue";H[e].addStream(window.localStream),H[e].createOffer().then((function(t){H[e].setLocalDescription(t).then((function(){$.emit("signal",e,JSON.stringify({sdp:H[e].localDescription}))})).catch((function(e){return console.log(e)}))}))};for(var a in H)t(a);e.getTracks().forEach((function(e){return e.onended=function(){n.setState({screen:!1},(function(){try{n.localVideoref.current.srcObject.getTracks().forEach((function(e){return e.stop()}))}catch(o){console.log(o)}window.localStream=function(){var e;return new MediaStream([(e=n).black.apply(e,arguments),n.silence()])}(),n.localVideoref.current.srcObject=window.localStream,n.getUserMedia()}))}}))},n.gotMessageFromServer=function(e,t){var a=JSON.parse(t);e!==G&&(a.sdp&&H[e].setRemoteDescription(new RTCSessionDescription(a.sdp)).then((function(){"offer"===a.sdp.type&&H[e].createAnswer().then((function(t){H[e].setLocalDescription(t).then((function(){$.emit("signal",e,JSON.stringify({sdp:H[e].localDescription}))})).catch((function(e){return console.log(e)}))})).catch((function(e){return console.log(e)}))})).catch((function(e){return console.log(e)})),a.ice&&H[e].addIceCandidate(new RTCIceCandidate(a.ice)).catch((function(e){return console.log(e)})))},n.changeCssVideos=function(e){var t="30%";30*e.offsetWidth/100<300&&(t="300px");var a=String(100/Y)+"%",n="";0===Y||1===Y?(n="100%",a="100%"):2===Y?(n="45%",a="100%"):3===Y||4===Y?(n="35%",a="50%"):n=String(100/Y)+"%";for(var o=e.querySelectorAll("video"),r=0;r<o.length;++r)o[r].style.minWidth=t,o[r].style.minHeight="40%",o[r].style.setProperty("width",n),o[r].style.setProperty("height",a);return{minWidth:t,minHeight:"40%",width:n,height:a}},n.connectToSocketServer=function(){$||($=p.a.connect(B,{secure:!0})),$.on("signal",n.gotMessageFromServer),$.on("connect",(function(){var e=n.props.location.state&&n.props.location.state.password?n.props.location.state.password:n.state.password;$.emit("join-call",window.location.href,e),G=$.id,$.on("chat-message",n.addMessage),$.on("user-left",(function(e){var t=document.querySelector('[data-socket="'.concat(e,'"]'));if(null!==t){Y--,t.parentNode.removeChild(t);var a=document.getElementById("main");n.changeCssVideos(a)}})),$.on("user-joined",(function(e,t){if(t.forEach((function(e){if(H[e]=new RTCPeerConnection(z),H[e].onicecandidate=function(t){null!=t.candidate&&$.emit("signal",e,JSON.stringify({ice:t.candidate}))},H[e].onaddstream=function(a){var o=document.querySelector('[data-socket="'.concat(e,'"]'));if(null!==o)o.srcObject=a.stream;else{Y=t.length;var r=document.getElementById("main"),i=n.changeCssVideos(r),c=document.createElement("video"),s={minWidth:i.minWidth,minHeight:i.minHeight,maxHeight:"100%",margin:"10px",borderStyle:"solid",borderColor:"#bdbdbd",objectFit:"fill"};for(var l in s)c.style[l]=s[l];c.style.setProperty("width",i.width),c.style.setProperty("height",i.height),c.setAttribute("data-socket",e),c.srcObject=a.stream,c.autoplay=!0,c.playsinline=!0,r.appendChild(c)}},void 0!==window.localStream&&null!==window.localStream)H[e].addStream(window.localStream);else{window.localStream=function(){var e;return new MediaStream([(e=n).black.apply(e,arguments),n.silence()])}(),H[e].addStream(window.localStream)}})),e===G){var a=function(e){if(e===G)return"continue";try{H[e].addStream(window.localStream)}catch(t){}H[e].createOffer().then((function(t){H[e].setLocalDescription(t).then((function(){$.emit("signal",e,JSON.stringify({sdp:H[e].localDescription}))})).catch((function(e){return console.log(e)}))}))};for(var o in H)a(o)}}))}))},n.silence=function(){var e=new AudioContext,t=e.createOscillator(),a=t.connect(e.createMediaStreamDestination());return t.start(),e.resume(),Object.assign(a.stream.getAudioTracks()[0],{enabled:!1})},n.black=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.width,a=void 0===t?640:t,n=e.height,o=void 0===n?480:n,r=Object.assign(document.createElement("canvas"),{width:a,height:o});r.getContext("2d").fillRect(0,0,a,o);var i=r.captureStream();return Object.assign(i.getVideoTracks()[0],{enabled:!1})},n.handleVideo=function(){return n.setState({video:!n.state.video},(function(){return n.getUserMedia()}))},n.handleAudio=function(){return n.setState({audio:!n.state.audio},(function(){return n.getUserMedia()}))},n.handleScreen=function(){return n.setState({screen:!n.state.screen},(function(){return n.getDislayMedia()}))},n.handleEndCall=function(){try{n.localVideoref.current.srcObject.getTracks().forEach((function(e){return e.stop()}))}catch(e){}window.location.href="/"},n.openChat=function(){return n.setState({showModal:!0,newmessages:0})},n.closeChat=function(){return n.setState({showModal:!1})},n.handleMessage=function(e){return n.setState({message:e.target.value})},n.addMessage=function(e,t,a){n.setState((function(a){return{messages:[].concat(Object(u.a)(a.messages),[{sender:t,data:e}])}})),a!==G&&n.setState({newmessages:n.state.newmessages+1})},n.handleUsername=function(e){return n.setState({username:e.target.value})},n.handlePassword=function(e){return n.setState({password:e.target.value})},n.sendMessage=function(){$.emit("chat-message",n.state.message,n.state.username),n.setState({message:"",sender:n.state.username})},n.copyUrl=function(){var e=window.location.href;if(navigator.clipboard)navigator.clipboard.writeText(e).then((function(){R.b.success("Link copied to clipboard!")}),(function(){R.b.error("Failed to copy")}));else{var t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy"),R.b.success("Link copied to clipboard!")}catch(a){R.b.error("Failed to copy")}document.body.removeChild(t)}},n.connect=function(){($=p.a.connect(B,{secure:!0})).on("connect",(function(){$.emit("auth",window.location.href,n.state.password),$.on("accept",(function(e){e&&401===e.status?n.setState({error:e.message}):($=null,n.setState({askForUsername:!1},(function(){return n.getMedia()})))}))}))},n.isChrome=function(){var e=(navigator&&(navigator.userAgent||"")).toLowerCase(),t=(navigator&&(navigator.vendor||"")).toLowerCase();return null!==(/google inc/.test(t)?e.match(/(?:chrome|crios)\/(\d+)/):null)},n.localVideoref=o.a.createRef(),n.videoAvailable=!1,n.audioAvailable=!1,n.roomnames=window.location.href.split("/"),n.roomname=n.roomnames[n.roomnames.length-1],n.state={video:!1,audio:!1,screen:!1,showModal:!1,screenAvailable:!1,messages:[],message:"",password:"",newmessages:0,username:e&&e.location.state&&e.location.state.username?e.location.state.username:w.a.internet.userName(),askForUsername:!(e&&e.location.state&&e.location.state.username),error:""},H={},n.getPermissions(),n}return Object(s.a)(a,[{key:"componentDidMount",value:function(){this.props&&this.props.location.state&&this.props.location.state.username&&(this.getUserMedia(),this.connectToSocketServer())}},{key:"render",value:function(){var e=this;return!1===this.isChrome()?o.a.createElement("div",{style:{background:"white",width:"30%",height:"auto",padding:"20px",minWidth:"400px",textAlign:"center",margin:"auto",marginTop:"50px",justifyContent:"center"}},o.a.createElement("h1",null,"Sorry, this works only with Google Chrome")):o.a.createElement("div",null,!0===this.state.askForUsername?o.a.createElement("div",null,o.a.createElement("div",{style:{background:"white",width:"30%",height:"auto",padding:"20px",minWidth:"400px",textAlign:"center",margin:"auto",marginTop:"50px",justifyContent:"center"}},o.a.createElement("p",{style:{margin:0,fontWeight:"bold",paddingRight:"50px"}},"Connect the room ".concat(this.roomname)),o.a.createElement(I.a,{placeholder:"Username",value:this.state.username,onChange:function(t){return e.handleUsername(t)}}),o.a.createElement(I.a.Password,{placeholder:"Password room",value:this.state.password,onChange:function(t){return e.handlePassword(t)}}),this.state.error&&""!==this.state.error?o.a.createElement(W.a,{message:this.state.error,type:"error"}):null,o.a.createElement(L.a,{variant:"contained",color:"primary",onClick:this.connect,style:{margin:"20px"}},"Connect")),o.a.createElement("div",{style:{justifyContent:"center",textAlign:"center",paddingTop:"40px"}},o.a.createElement("video",{id:"my-video",ref:this.localVideoref,autoPlay:!0,muted:!0,style:{borderStyle:"solid",borderColor:"#bdbdbd",objectFit:"fill",width:"60%",height:"30%"}}))):o.a.createElement("div",null,o.a.createElement("div",{className:"btn-down",style:{backgroundColor:"whitesmoke",color:"whitesmoke",textAlign:"center"}},o.a.createElement(y.a,{style:{color:"#424242"},onClick:this.handleVideo},!0===this.state.video?o.a.createElement(E.a,null):o.a.createElement(k.a,null)),o.a.createElement(y.a,{style:{color:"#f44336"},onClick:this.handleEndCall},o.a.createElement(P.a,null)),o.a.createElement(y.a,{style:{color:"#424242"},onClick:this.handleAudio},!0===this.state.audio?o.a.createElement(x.a,null):o.a.createElement(j.a,null)),!0===this.state.screenAvailable?o.a.createElement(y.a,{style:{color:"#424242"},onClick:this.handleScreen},!0===this.state.screen?o.a.createElement(D.a,null):o.a.createElement(U.a,null)):null,o.a.createElement(b.a,{badgeContent:this.state.newmessages,max:999,color:"secondary",onClick:this.openChat},o.a.createElement(y.a,{style:{color:"#424242"},onClick:this.openChat},o.a.createElement(F.a,null)))),o.a.createElement(q.a,{show:this.state.showModal,onHide:this.closeChat,style:{zIndex:"999999"}},o.a.createElement(q.a.Header,{closeButton:!0},o.a.createElement(q.a.Title,null,"Chat Room")),o.a.createElement(q.a.Body,{style:{overflow:"auto",overflowY:"auto",height:"400px",textAlign:"left"}},this.state.messages.length>0?this.state.messages.map((function(e,t){return o.a.createElement("div",{key:t,style:{textAlign:"left"}},o.a.createElement("p",{style:{wordBreak:"break-all"}},o.a.createElement("b",null,e.sender),": ",e.data))})):o.a.createElement("p",null,"No message yet")),o.a.createElement(q.a.Footer,{className:"div-send-msg"},o.a.createElement(I.a,{placeholder:"Message",value:this.state.message,onChange:function(t){return e.handleMessage(t)}}),o.a.createElement(L.a,{variant:"contained",color:"primary",onClick:this.sendMessage},"Send"))),o.a.createElement("div",{className:"container"},o.a.createElement("div",{style:{paddingTop:"20px"}},o.a.createElement(I.a,{value:window.location.href,disable:"true"}),o.a.createElement(L.a,{style:{backgroundColor:"#3f51b5",color:"whitesmoke",marginLeft:"20px",marginTop:"10px",width:"120px",fontSize:"10px"},onClick:this.copyUrl},"Copy invite link")),o.a.createElement(J.a,{id:"main",className:"flex-container",style:{margin:0,padding:0}},o.a.createElement("video",{id:"my-video",ref:this.localVideoref,autoPlay:!0,muted:!0,style:{borderStyle:"solid",borderColor:"#bdbdbd",margin:"10px",objectFit:"fill",width:"100%",height:"100%"}})))))}}]),a}(n.Component),Q=a(110),X=a(1399),Z=(a(1310),{labelCol:{span:8},wrapperCol:{span:16}}),_={required:"${label} is required!"},ee=function(e){return o.a.createElement("div",{style:{justifyContent:"center",alignItems:"center",margin:20}},o.a.createElement("h1",{style:{fontSize:"45px"}},"Video Meeting"),o.a.createElement("p",{style:{fontWeight:"200"}},"Video conference website that lets you stay in touch with all your friends."),o.a.createElement("div",{style:{paddingTop:100,paddingRight:200}},o.a.createElement(X.a,Object.assign({},Z,{name:"nest-messages",onFinish:function(t){if(t&&t.room)if(""!==t.room.roomname){var a=t.room.roomname.split("/");e&&e.history&&e.history.push({pathname:"/".concat(a[a.length-1]),state:{username:t.room.username,password:t.room.password}})}else{var n=Math.random().toString(36).substring(2,7);e&&e.history&&e.history.push({pathname:"/".concat(n[n.length-1]),state:{username:t.room.username,password:t.room.password}})}},validateMessages:_}),o.a.createElement(X.a.Item,{name:["room","username"],label:"Username",rules:[{required:!0}]},o.a.createElement(I.a,null)),o.a.createElement(X.a.Item,{name:["room","roomname"],label:"Room name",rules:[{required:!0}]},o.a.createElement(I.a,null)),o.a.createElement(X.a.Item,{name:["room","password"],label:"Password Room",rules:[{required:!0}]},o.a.createElement(I.a.Password,null)),o.a.createElement(X.a.Item,{wrapperCol:Object(Q.a)(Object(Q.a)({},Z.wrapperCol),{},{offset:8})},o.a.createElement(L.a,{type:"primary",htmlType:"submit"},"Create Room")))))},te=a(171),ae=a(19),ne=function(e){Object(l.a)(a,e);var t=Object(d.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(s.a)(a,[{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement(te.a,null,o.a.createElement(ae.c,null,o.a.createElement(ae.a,{path:"/",exact:!0,component:ee}),o.a.createElement(ae.a,{path:"/:url",component:K}))))}}]),a}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(ne,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},180:function(e,t,a){e.exports=a(1381)},210:function(e,t){}},[[180,1,2]]]);
//# sourceMappingURL=main.0cab46ff.chunk.js.map